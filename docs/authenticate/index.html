<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>Documentation: Authenticate</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="http://www.passportjs.org/docs/authenticate/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Documentation: Authenticate"/>
    <meta property="og:url" content="http://www.passportjs.org/docs/authenticate/"/>
    <meta property="og:image" content="http://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="Documentation: Authenticate"/>
    <meta name="twitter:image" content="http://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd">
    <link type="text/css" rel="stylesheet" href="http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </nav>
      <div id="content">
        <div class="book" id="book">
          <div class="toc">
            <nav data-accordion-group="">
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/docs/authenticate/"></a>General</h5>
                <ul data-content="">
                  <li><a class="active" href="/docs/authenticate/">Authenticate</a></li>
                  <li><a href="/docs/configure/">Configure</a></li>
                  <li><a href="/docs/username-password/">Username & Password</a></li>
                  <li><a href="/docs/openid/">OpenID</a></li>
                  <li><a href="/docs/oauth/">OAuth</a></li>
                  <li><a href="/docs/profile/">User Profile</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/docs/facebook/"></a>Providers</h5>
                <ul data-content="">
                  <li><a href="/docs/facebook/">Facebook</a></li>
                  <li><a href="/docs/twitter/">Twitter</a></li>
                  <li><a href="/docs/google/">Google</a></li>
                  <li><a href="/packages/">Other</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/docs/basic-digest/"></a>APIs</h5>
                <ul data-content="">
                  <li><a href="/docs/basic-digest/">Basic & Digest</a></li>
                  <li><a href="/docs/oauth-api/">OAuth</a></li>
                  <li><a href="/docs/oauth2-api/">OAuth 2.0</a></li>
                  <li><a href="/docs/other-api/">Other</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/docs/login/"></a>Operations</h5>
                <ul data-content="">
                  <li><a href="/docs/login/">Log In</a></li>
                  <li><a href="/docs/logout/">Log Out</a></li>
                  <li><a href="/docs/authorize/">Authorize</a></li>
                </ul>
              </div>
            </nav>
          </div><a id="go-top" href="#top"><i class="icon-budicon-462"></i></a>
          <div class="contents">
            <section class="chapter"><h1 id="authenticate">Authenticate</h1>
<p>Authenticating requests is as simple as calling <code>passport.authenticate()</code> and
specifying which strategy to employ.  <code>authenticate()</code>&#39;s function signature is
standard <a href="http://www.senchalabs.org/connect/">Connect</a> middleware, which makes it
convenient to use as route middleware in <a href="http://expressjs.com/">Express</a>
applications.</p>
<pre><code class="lang-javascript">app.post(<span class="string">'/login'</span>,
  passport.authenticate(<span class="string">'local'</span>),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    <span class="comment">// If this function gets called, authentication was successful.</span>
    <span class="comment">// `req.user` contains the authenticated user.</span>
    res.redirect(<span class="string">'/users/'</span> + req.user.username);
  });
</code></pre>
<p>By default, if authentication fails, Passport will respond with a
<code>401 Unauthorized</code> status, and any additional route handlers will not be
invoked.  If authentication succeeds, the next handler will be invoked and the
<code>req.user</code> property will be set to the authenticated user.</p>
<p>Note: Strategies must be configured prior to using them in a route.  Continue
reading the chapter on <a href="/guide/configure/">configuration</a> for details.</p>
<h2 id="redirects">Redirects</h2>
<p>A redirect is commonly issued after authenticating a request.</p>
<pre><code class="lang-javascript">app.post(<span class="string">'/login'</span>,
  passport.authenticate(<span class="string">'local'</span>, { <span class="attr">successRedirect</span>: <span class="string">'/'</span>,
                                   <span class="attr">failureRedirect</span>: <span class="string">'/login'</span> }));
</code></pre>
<p>In this case, the redirect options override the default behavior.  Upon
successful authentication, the user will be redirected to the home page.  If
authentication fails, the user will be redirected back to the login page for
another attempt.</p>
<h2 id="flash-messages">Flash Messages</h2>
<p>Redirects are often combined with flash messages in order to display status
information to the user.</p>
<pre><code class="lang-javascript">app.post(<span class="string">'/login'</span>,
  passport.authenticate(<span class="string">'local'</span>, { <span class="attr">successRedirect</span>: <span class="string">'/'</span>,
                                   <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>,
                                   <span class="attr">failureFlash</span>: <span class="literal">true</span> })
);
</code></pre>
<p>Setting the <code>failureFlash</code> option to <code>true</code> instructs Passport to flash an
<code>error</code> message using the message given by the strategy&#39;s verify callback, if
any.  This is often the best approach, because the verify callback can make the
most accurate determination of why authentication failed.</p>
<p>Alternatively, the flash message can be set specifically.</p>
<pre><code class="lang-javascript">passport.authenticate(<span class="string">'local'</span>, { <span class="attr">failureFlash</span>: <span class="string">'Invalid username or password.'</span> });
</code></pre>
<p>A <code>successFlash</code> option is available which flashes a <code>success</code> message when
authentication succeeds.</p>
<pre><code class="lang-javascript">passport.authenticate(<span class="string">'local'</span>, { <span class="attr">successFlash</span>: <span class="string">'Welcome!'</span> });
</code></pre>
<p>Note: Using flash messages requires a <code>req.flash()</code> function.  Express 2.x
provided this functionality, however it was removed from Express 3.x.  Use of
<a href="https://github.com/jaredhanson/connect-flash">connect-flash</a> middleware is
recommended to provide this functionality when using Express 3.x.</p>
<h2 id="disable-sessions">Disable Sessions</h2>
<p>After successful authentication, Passport will establish a persistent login
session.  This is useful for the common scenario of users accessing a web
application via a browser.  However, in some cases, session support is not
necessary.  For example, API servers typically require credentials to be
supplied with each request.  When this is the case, session support can be
safely disabled by setting the <code>session</code> option to <code>false</code>.</p>
<pre><code class="lang-javascript">app.get(<span class="string">'/api/users/me'</span>,
  passport.authenticate(<span class="string">'basic'</span>, { <span class="attr">session</span>: <span class="literal">false</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.json({ <span class="attr">id</span>: req.user.id, <span class="attr">username</span>: req.user.username });
  });
</code></pre>
<h2 id="custom-callback">Custom Callback</h2>
<p>If the built-in options are not sufficient for handling an authentication
request, a custom callback can be provided to allow the application to handle
success or failure.</p>
<pre><code class="lang-javascript">app.get(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>{
  passport.authenticate(<span class="string">'local'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, user, info</span>) </span>{
    <span class="keyword">if</span> (err) { <span class="keyword">return</span> next(err); }
    <span class="keyword">if</span> (!user) { <span class="keyword">return</span> res.redirect(<span class="string">'/login'</span>); }
    req.logIn(user, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> next(err); }
      <span class="keyword">return</span> res.redirect(<span class="string">'/users/'</span> + user.username);
    });
  })(req, res, next);
});
</code></pre>
<p>In this example, note that <code>authenticate()</code> is called from within the route
handler, rather than being used as route middleware.  This gives the callback
access to the <code>req</code> and <code>res</code> objects through closure.</p>
<p>If authentication failed, <code>user</code> will be set to <code>false</code>.  If an exception
occurred, <code>err</code> will be set.  An optional <code>info</code> argument will be passed,
containing additional details provided by the strategy&#39;s verify callback.</p>
<p>The callback can use the arguments supplied to handle the authentication result
as desired.  Note that when using a custom callback, it becomes the
application&#39;s responsibility to establish a session (by calling <code>req.login()</code>)
and send a response.</p>
</section>
          </div>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-104798-10']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      
    </script>
    <!-- Google Tag Manager-->
    <noscript>iframe(src='//www.googletagmanager.com/ns.html?id=GTM-M5S3PH', height='0', width='0', style='display:none;visibility:hidden')</noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M5S3PH');
    </script>
    <!-- End Google Tag Manager-->
  </body>
</html>
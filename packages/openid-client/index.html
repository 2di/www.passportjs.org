<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>openid-client</title>
    <meta charset="utf-8">
    <meta name="description" content="OpenID Connect Relying Party (RP, Client) implementation for Node.js servers, supports passportjs">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="http://www.passportjs.org/packages/openid-client/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="openid-client"/>
    <meta property="og:description" content="OpenID Connect Relying Party (RP, Client) implementation for Node.js servers, supports passportjs"/>
    <meta property="og:url" content="http://www.passportjs.org/packages/openid-client/"/>
    <meta property="og:image" content="http://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="openid-client"/>
    <meta name="twitter:description" content="OpenID Connect Relying Party (RP, Client) implementation for Node.js servers, supports passportjs"/>
    <meta name="twitter:image" content="http://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd">
    <link type="text/css" rel="stylesheet" href="http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="openid-client">openid-client</h1>
<p><a href="https://travis-ci.org/panva/node-openid-client"><img src="https://img.shields.io/travis/panva/node-openid-client/master.svg?style=flat-square&amp;maxAge=7200" alt="build"></a> <a href="https://codecov.io/gh/panva/node-openid-client"><img src="https://img.shields.io/codecov/c/github/panva/node-openid-client/master.svg?style=flat-square&amp;maxAge=7200" alt="codecov"></a></p>
<p>openid-client is a server side <a href="http://openid.net/connect/">OpenID</a> Relying Party (RP, Client) implementation for
Node.js, supports <a href="http://passportjs.org">passport</a>.</p>
<p><strong>Table of Contents</strong></p>
<!-- TOC START min:2 max:2 link:true update:true -->
<ul>
<li><a href="#implemented-specs--features">Implemented specs &amp; features</a></li>
<li><a href="#certification">Certification</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#get-started">Get started</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#usage-with-passport">Usage with passport</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul>
<!-- TOC END -->
<h2 id="implemented-specs-features">Implemented specs &amp; features</h2>
<p>The following client/RP features from OpenID Connect/OAuth2.0 specifications are implemented by
openid-client.</p>
<ul>
<li><a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0 incorporating errata set 1</a><ul>
<li>Authorization Callback<ul>
<li>Authorization Code Flow</li>
<li>Implicit Flow</li>
<li>Hybrid Flow</li>
</ul>
</li>
<li>UserInfo Request</li>
<li>Fetching Distributed Claims</li>
<li>Unpacking Aggregated Claims</li>
<li>Offline Access / Refresh Token Grant</li>
<li>Client Credentials Grant</li>
<li>Password Grant</li>
<li>Client Authentication<ul>
<li>client_secret_basic</li>
<li>client_secret_post</li>
<li>client_secret_jwt</li>
<li>private_key_jwt</li>
</ul>
</li>
</ul>
</li>
<li><a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0 incorporating errata set 1</a><ul>
<li>Discovery of OpenID Provider (Issuer) Metadata</li>
<li>Discovery of OpenID Provider (Issuer) Metadata via user provided inputs (see #WebFinger)</li>
</ul>
</li>
<li><a href="http://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1</a><ul>
<li>Dynamic Client Registration request</li>
<li>Client initialization via registration client uri</li>
</ul>
</li>
<li><a href="https://tools.ietf.org/html/rfc7009">RFC7009 - OAuth 2.0 Token revocation</a><ul>
<li>Client Authenticated request to token revocation</li>
</ul>
</li>
<li><a href="https://tools.ietf.org/html/rfc7662">RFC7662 - OAuth 2.0 Token introspection</a><ul>
<li>Client Authenticated request to token introspection</li>
</ul>
</li>
</ul>
<h2 id="certification">Certification</h2>
<p><a href="http://openid.net/certification/"><img width="184" height="96" align="right" src="https://cdn.rawgit.com/panva/node-openid-client/38cf016b/OpenID_Certified.png" alt="OpenID Certification"></a><br>Filip Skokan has <a href="http://openid.net/certification/">certified</a> that <a href="https://www.npmjs.com/package/openid-client">openid-client</a>
conforms to the RP Basic, RP Implicit, RP Hybrid, RP Config and RP Dynamic profiles
of the OpenID Connectâ„¢ protocol.</p>
<p><a href="https://github.com/panva/openid-client-conformance-tests"><img src="https://img.shields.io/travis/panva/openid-client-conformance-tests/master.svg?style=flat-square&amp;maxAge=7200&amp;label=conformance%20build" alt="build"></a></p>
<h2 id="example">Example</h2>
<p>Head over to the example folder to see the library in use. This example is deployed and configured
to use an example OpenID Connect Provider <a href="https://tranquil-reef-95185.herokuapp.com/client">here</a>. The provider is using
<a href="https://github.com/panva/node-oidc-provider">oidc-provider</a> library.</p>
<h2 id="get-started">Get started</h2>
<p>On the off-chance you want to manage multiple clients for multiple issuers you need to first get
an Issuer instance.</p>
<h3 id="via-discovery-recommended-">via Discovery (recommended)</h3>
<pre><code class="lang-js"><span class="keyword">const</span> Issuer = <span class="built_in">require</span>(<span class="string">'openid-client'</span>).Issuer;
Issuer.discover(<span class="string">'https://accounts.google.com'</span>) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">googleIssuer</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'Discovered issuer %s'</span>, googleIssuer);
  });
</code></pre>
<h3 id="manually">manually</h3>
<pre><code class="lang-js"><span class="keyword">const</span> Issuer = <span class="built_in">require</span>(<span class="string">'openid-client'</span>).Issuer;
<span class="keyword">const</span> googleIssuer = <span class="keyword">new</span> Issuer({
  <span class="attr">issuer</span>: <span class="string">'https://accounts.google.com'</span>,
  <span class="attr">authorization_endpoint</span>: <span class="string">'https://accounts.google.com/o/oauth2/v2/auth'</span>,
  <span class="attr">token_endpoint</span>: <span class="string">'https://www.googleapis.com/oauth2/v4/token'</span>,
  <span class="attr">userinfo_endpoint</span>: <span class="string">'https://www.googleapis.com/oauth2/v3/userinfo'</span>,
  <span class="attr">jwks_uri</span>: <span class="string">'https://www.googleapis.com/oauth2/v3/certs'</span>,
}); <span class="comment">// =&gt; Issuer</span>
<span class="built_in">console</span>.log(<span class="string">'Set up issuer %s'</span>, googleIssuer);
</code></pre>
<p><strong>Now you can create your Client.</strong></p>
<h3 id="manually-recommended-">manually (recommended)</h3>
<p>You should provide at least the following metadata; <code>client_id, client_secret</code>. You can also provide
<code>id_token_signed_response_alg</code> (defaults to <code>RS256</code>) and <code>token_endpoint_auth_method</code> (defaults to
<code>client_secret_basic</code>).</p>
<pre><code class="lang-js"><span class="keyword">const</span> client = <span class="keyword">new</span> googleIssuer.Client({
  <span class="attr">client_id</span>: <span class="string">'zELcpfANLqY7Oqas'</span>,
  <span class="attr">client_secret</span>: <span class="string">'TQV5U29k1gHibH5bx1layBo0OSAvAbRT3UYW3EWrSYBB5swxjVfWUa1BS8lqzxG/0v9wruMcrGadany3'</span>
}, [keystore]); <span class="comment">// =&gt; Client</span>
</code></pre>
<p><code>keystore</code> is an optional argument for instantiating a client with configured asymmetrical
ID Token or UserInfo response encryption.</p>
<h3 id="via-registration-client-uri">via registration client uri</h3>
<p>Should your oidc provider have provided you with a registration client uri and registration access
token you can also have the Client discovered.</p>
<pre><code class="lang-js">googleIssuer.Client.fromUri(registration_client_uri, registration_access_token, [keystore]) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">client</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'Discovered client %s'</span>, client);
  });
</code></pre>
<p><code>keystore</code> is an optional argument for instantiating a client through registration client uri
with configured asymmetrical ID Token or UserInfo response encryption.</p>
<h2 id="usage">Usage</h2>
<h3 id="getting-authorization-url">Getting authorization url</h3>
<pre><code class="lang-js">client.authorizationUrl({
  <span class="attr">redirect_uri</span>: <span class="string">'https://client.example.com/callback'</span>,
  <span class="attr">scope</span>: <span class="string">'openid email'</span>,
}); <span class="comment">// =&gt; String (URL)</span>
</code></pre>
<p>You can also get HTML body of a self-submitting form to utilize POST to the authorization url with
<code>#authorizationPost</code> method, same signature as <code>#authorizationUrl</code>.</p>
<pre><code class="lang-js">client.authorizationPost({
  <span class="attr">redirect_uri</span>: <span class="string">'https://client.example.com/callback'</span>,
  <span class="attr">scope</span>: <span class="string">'openid email'</span>,
}); <span class="comment">// =&gt; String (Valid HTML body)</span>
</code></pre>
<h3 id="processing-callback">Processing callback</h3>
<pre><code class="lang-js">client.authorizationCallback(<span class="string">'https://client.example.com/callback'</span>, request.query) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">tokenSet</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'received and validated tokens %j'</span>, tokenSet);
    <span class="built_in">console</span>.log(<span class="string">'validated id_token claims %j'</span>, tokenSet.claims);
  });
</code></pre>
<h3 id="processing-callback-with-state-nonce-or-max_age-check">Processing callback with state, nonce or max_age check</h3>
<pre><code class="lang-js"><span class="keyword">const</span> state = session.state;
<span class="keyword">const</span> nonce = session.nonce;

client.authorizationCallback(<span class="string">'https://client.example.com/callback'</span>, request.query, { state, nonce, max_age }) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">tokenSet</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'received and validated tokens %j'</span>, tokenSet);
    <span class="built_in">console</span>.log(<span class="string">'validated id_token claims %j'</span>, tokenSet.claims);
  });
</code></pre>
<h3 id="handling-multiple-response-modes">Handling multiple response modes</h3>
<p>When handling multiple response modes with one single pass you can use <code>#callbackParams</code>
to get the params object from the koa/express/node request object or a url string.
(http.IncomingMessage). If form_post is your response_type you need to include a body parser prior.</p>
<pre><code class="lang-js">client.callbackParams(<span class="string">'https://client.example.com/cb?code=code'</span>); <span class="comment">// =&gt; { code: 'code' };</span>
client.callbackParams(<span class="string">'/cb?code=code'</span>); <span class="comment">// =&gt; { code: 'code' };</span>

<span class="comment">// example koa v2.x w/ koa-body</span>
app.use(bodyParser({ <span class="attr">patchNode</span>: <span class="literal">true</span> }));
app.use(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">ctx, next</span>) </span>{
  <span class="keyword">const</span> params = client.callbackParams(ctx.request.req); <span class="comment">// =&gt; parsed url query, url fragment or body object</span>
  <span class="comment">// ...</span>
});

<span class="comment">// example express w/ bodyParser</span>
app.use(bodyParser.urlencoded({ <span class="attr">extended</span>: <span class="literal">false</span> }));
app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
  <span class="keyword">const</span> params = client.callbackParams(req); <span class="comment">// =&gt; parsed url query, url fragment or body object</span>
  <span class="comment">// ...</span>
});
</code></pre>
<h3 id="refreshing-a-token">Refreshing a token</h3>
<pre><code class="lang-js">client.refresh(refreshToken) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">tokenSet</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'refreshed and validated tokens %j'</span>, tokenSet);
    <span class="built_in">console</span>.log(<span class="string">'refreshed id_token claims %j'</span>, tokenSet.claims);
  });
</code></pre>
<p>Tip: accepts TokenSet as well as direct refresh token values;</p>
<h3 id="revoke-a-token">Revoke a token</h3>
<pre><code class="lang-js">client.revoke(token, [tokenTypeHint]) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'revoked token %s'</span>, token, response);
  });
</code></pre>
<h3 id="introspect-a-token">Introspect a token</h3>
<pre><code class="lang-js">client.introspect(token, [tokenTypeHint]) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'token details %j'</span>, response);
  });
</code></pre>
<h3 id="fetching-userinfo">Fetching userinfo</h3>
<pre><code class="lang-js">client.userinfo(accessToken) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">userinfo</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'userinfo %j'</span>, userinfo);
  });
</code></pre>
<p>Tip: accepts TokenSet as well as direct access token values;</p>
<p>via POST</p>
<pre><code class="lang-js">client.userinfo(accessToken, { <span class="attr">verb</span>: <span class="string">'post'</span> }); <span class="comment">// =&gt; Promise</span>
</code></pre>
<p>with extra query/body payload</p>
<pre><code class="lang-js">client.userinfo(accessToken, { <span class="attr">params</span>: { <span class="attr">fields</span>: <span class="string">'email,ids_for_business'</span> } }); <span class="comment">// =&gt; Promise</span>
</code></pre>
<p>auth via query</p>
<pre><code class="lang-js">client.userinfo(accessToken, { <span class="attr">via</span>: <span class="string">'query'</span> }); <span class="comment">// =&gt; Promise</span>
</code></pre>
<p>auth via body</p>
<pre><code class="lang-js">client.userinfo(accessToken, { <span class="attr">verb</span>: <span class="string">'post'</span>, <span class="attr">via</span>: <span class="string">'body'</span> }); <span class="comment">// =&gt; Promise</span>
</code></pre>
<p>userinfo also handles (as long as you have the proper metadata configured) responses that are:</p>
<ul>
<li>signed</li>
<li>signed and encrypted (nested JWT)</li>
<li>just encrypted</li>
</ul>
<h3 id="fetching-distributed-claims">Fetching Distributed Claims</h3>
<pre><code class="lang-js"><span class="keyword">let</span> claims = {
  <span class="attr">sub</span>: <span class="string">'userID'</span>,
  <span class="attr">_claim_names</span>: {
    <span class="attr">credit_history</span>: <span class="string">'src1'</span>,
    <span class="attr">email</span>: <span class="string">'src2'</span>,
  },
  <span class="attr">_claim_sources</span>: {
    <span class="attr">src1</span>: { <span class="attr">endpoint</span>: <span class="string">'https://src1.example.com/claims'</span>, <span class="attr">access_token</span>: <span class="string">'foobar'</span> },
    <span class="attr">src2</span>: { <span class="attr">endpoint</span>: <span class="string">'https://src2.example.com/claims'</span> },
  },
};

client.fetchDistributedClaims(claims, { <span class="attr">src2</span>: <span class="string">'bearer.for.src2'</span> }) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">output</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'claims %j'</span>, claims); <span class="comment">// ! also modifies original input, does not create a copy</span>
    <span class="built_in">console</span>.log(<span class="string">'output %j'</span>, output);
    <span class="comment">// removes fetched names and sources and removes _claim_names and _claim_sources members if they</span>
    <span class="comment">// are empty</span>
  });
  <span class="comment">// when rejected the error will have a property 'src' with the source name it relates to</span>
</code></pre>
<h3 id="unpacking-aggregated-claims">Unpacking Aggregated Claims</h3>
<pre><code class="lang-js"><span class="keyword">let</span> claims = {
  <span class="attr">sub</span>: <span class="string">'userID'</span>,
  <span class="attr">_claim_names</span>: {
    <span class="attr">credit_history</span>: <span class="string">'src1'</span>,
    <span class="attr">email</span>: <span class="string">'src2'</span>,
  },
  <span class="attr">_claim_sources</span>: {
    <span class="attr">src1</span>: { <span class="attr">JWT</span>: <span class="string">'probably.a.jwt'</span> },
    <span class="attr">src2</span>: { <span class="attr">JWT</span>: <span class="string">'probably.another.jwt'</span> },
  },
};

client.unpackAggregatedClaims(claims) <span class="comment">// =&gt; Promise, autodiscovers JWT issuers, verifies signatures</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">output</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'claims %j'</span>, claims); <span class="comment">// ! also modifies original input, does not create a copy</span>
    <span class="built_in">console</span>.log(<span class="string">'output %j'</span>, output);
    <span class="comment">// removes fetched names and sources and removes _claim_names and _claim_sources members if they</span>
    <span class="comment">// are empty</span>
  });
  <span class="comment">// when rejected the error will have a property 'src' with the source name it relates to</span>
</code></pre>
<h3 id="custom-token-endpoint-grants">Custom token endpoint grants</h3>
<p>Use when the token endpoint also supports client_credentials or password grants;</p>
<pre><code class="lang-js">client.grant({
  <span class="attr">grant_type</span>: <span class="string">'client_credentials'</span>
}); <span class="comment">// =&gt; Promise</span>

client.grant({
  <span class="attr">grant_type</span>: <span class="string">'password'</span>,
  <span class="attr">username</span>: <span class="string">'johndoe'</span>,
  <span class="attr">password</span>: <span class="string">'A3ddj3w'</span>,
}); <span class="comment">// =&gt; Promise</span>
</code></pre>
<h3 id="registering-new-client-via-dynamic-registration-">Registering new client (via Dynamic Registration)</h3>
<pre><code class="lang-js"><span class="keyword">const</span> opts = { keystore, initialAccessToken }; <span class="comment">// both optional</span>
issuer.Client.register(metadata, [opts]) <span class="comment">// =&gt; opts optional, Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">client</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'Registered client %s, %j'</span>, client, client.metadata);
  });
</code></pre>
<h3 id="generating-a-signed-encrypted-request-object">Generating a signed/encrypted Request Object</h3>
<pre><code class="lang-js">client.requestObject({ <span class="attr">response_mode</span>: <span class="string">'form_post'</span> }, {
  <span class="attr">sign</span>: client.request_object_signing_alg,
  <span class="attr">encrypt</span>: {
    <span class="attr">alg</span>: client.request_object_encryption_alg,
    <span class="attr">enc</span>: client.request_object_encryption_enc,
  }
}).then(<span class="function"><span class="keyword">function</span> (<span class="params">request</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Nested signed and encrypted JWT Request Object %s'</span>, request)
});
</code></pre>
<h3 id="webfinger-discovery">WebFinger discovery</h3>
<pre><code class="lang-js">Issuer.webfinger(userInput) <span class="comment">// =&gt; Promise</span>
  .then(<span class="function"><span class="keyword">function</span> (<span class="params">issuer</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'Discovered issuer %s'</span>, issuer);
  });
</code></pre>
<p>Accepts, normalizes, discovers and validates the discovery of User Input using E-Mail, URL, acct,
Hostname and Port syntaxes as described in <a href="http://openid.net/specs/openid-connect-discovery-1_0.html">Discovery 1.0</a>.</p>
<p>Uses already discovered (cached) issuers where applicable.</p>
<h3 id="tokenset">TokenSet</h3>
<p><code>authorizationCallback</code> and <code>refresh</code> methods on a Client return TokenSet, when assigned an
<code>expires_in</code> value a TokenSet calculates and assigns an <code>expires_at</code> with the corresponding unix
time. It also comes with few helpers.</p>
<pre><code class="lang-js">client.authorizationCallback(..., ...).then(<span class="function"><span class="keyword">function</span> (<span class="params">tokenSet</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'tokenSet#expires_at'</span>, tokenSet.expires_at);
  <span class="built_in">console</span>.log(<span class="string">'tokenSet#expires_in'</span>, tokenSet.expires_in);
  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'tokenSet#expires_in'</span>, tokenSet.expires_in);
  }, <span class="number">2000</span>);
  <span class="built_in">console</span>.log(<span class="string">'tokenSet#expired()'</span>, tokenSet.expired());
  <span class="built_in">console</span>.log(<span class="string">'tokenSet#claims'</span>, tokenSet.claims);
});
</code></pre>
<h2 id="usage-with-passport">Usage with passport</h2>
<p>Once you have a Client instance, just pass it to the Strategy. Issuer is best discovered, Client
passed properties manually or via an uri (see <a href="#get-started">get-started</a>).</p>
<p>Verify function is invoked with a TokenSet, userinfo only when requested, last argument is always
the done function which you invoke once you found your user.</p>
<pre><code class="lang-js"><span class="keyword">const</span> Strategy = <span class="built_in">require</span>(<span class="string">'openid-client'</span>).Strategy;
<span class="keyword">const</span> params = {
  <span class="comment">// ... any authorization request parameters go here</span>
  <span class="comment">// client_id defaults to client.client_id</span>
  <span class="comment">// redirect_uri defaults to client.redirect_uris[0]</span>
  <span class="comment">// response type defaults to client.response_types[0], then 'code'</span>
  <span class="comment">// scope defaults to 'openid'</span>
}
<span class="keyword">const</span> passReqToCallback = <span class="literal">false</span>; <span class="comment">// optional, defaults to false, when true req is passed as a first</span>
                                 <span class="comment">// argument to verify fn</span>

<span class="keyword">const</span> usePKCE = <span class="literal">true</span>; <span class="comment">// optional, defaults to false, when true the code_challenge_method will be</span>
                      <span class="comment">// resolved from the issuer configuration, instead of true you may provide</span>
                      <span class="comment">// any of the supported values directly, i.e. "S256" (recommended) or "plain"</span>

passport.use(<span class="string">'oidc'</span>, <span class="keyword">new</span> Strategy({ client, [params], [passReqToCallback], [usePKCE] }, (tokenset, userinfo, done) =&gt; {
  <span class="built_in">console</span>.log(<span class="string">'tokenset'</span>, tokenset);
  <span class="built_in">console</span>.log(<span class="string">'access_token'</span>, tokenset.access_token);
  <span class="built_in">console</span>.log(<span class="string">'id_token'</span>, tokenset.id_token);
  <span class="built_in">console</span>.log(<span class="string">'claims'</span>, tokenset.claims);
  <span class="built_in">console</span>.log(<span class="string">'userinfo'</span>, userinfo);

  User.findOne({ <span class="attr">id</span>: tokenset.claims.sub }, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
    <span class="keyword">if</span> (err) <span class="keyword">return</span> done(err);
    <span class="keyword">return</span> done(<span class="literal">null</span>, user);
  });
}));

<span class="comment">// start authentication request</span>
<span class="comment">// options [optional], extra authentication parameters</span>
app.get(<span class="string">'/auth'</span>, passport.authenticate(<span class="string">'oidc'</span>, [options]));

<span class="comment">// authentication callback</span>
app.get(<span class="string">'/auth/cb'</span>, passport.authenticate(<span class="string">'oidc'</span>, { <span class="attr">successRedirect</span>: <span class="string">'/'</span>, <span class="attr">failureRedirect</span>: <span class="string">'/login'</span> }));
</code></pre>
<h2 id="configuration">Configuration</h2>
<h3 id="allow-for-system-clock-skew">Allow for system clock skew</h3>
<p>It is possible the RP or OP environment has a system clock skew, to set a clock tolerance (in seconds)</p>
<pre><code class="lang-js">client.CLOCK_TOLERANCE = <span class="number">5</span>; <span class="comment">// to allow a 5 second skew</span>
</code></pre>
<h3 id="changing-http-request-defaults">Changing HTTP request defaults</h3>
<p>Setting <code>defaultHttpOptions</code> on <code>Issuer</code> always merges your passed options with the default.
openid-client uses <a href="https://github.com/sindresorhus/got">got</a> for http requests with the following default request options</p>
<pre><code class="lang-js"><span class="keyword">const</span> DEFAULT_HTTP_OPTIONS = {
  <span class="attr">followRedirect</span>: <span class="literal">false</span>,
  <span class="attr">headers</span>: { <span class="string">'User-Agent'</span>: <span class="string">`<span class="subst">${pkg.name}</span>/<span class="subst">${pkg.version}</span> (<span class="subst">${pkg.homepage}</span>)`</span> },
  <span class="attr">retries</span>: <span class="number">0</span>,
  <span class="attr">timeout</span>: <span class="number">1500</span>,
};
</code></pre>
<p>You can add your own headers, change the user-agent used or change the timeout setting</p>
<pre><code class="lang-js">Issuer.defaultHttpOptions = { <span class="attr">timeout</span>: <span class="number">2500</span>, <span class="attr">headers</span>: { <span class="string">'X-Your-Header'</span>: <span class="string">'&lt;whatever&gt;'</span> } };
</code></pre>
<p>Confirm your httpOptions by</p>
<pre><code class="lang-js"><span class="built_in">console</span>.log(<span class="string">'httpOptions %j'</span>, Issuer.defaultHttpOptions);
</code></pre>
<h3 id="proxy-settings">Proxy settings</h3>
<p>Because of the lightweight nature of <a href="https://github.com/sindresorhus/got">got</a> library the client will not use
environment-defined http(s) proxies. In order to have them used you&#39;ll need to either provide your own http request
implementation using the provided <code>httpClient</code> setter or use the bundled <a href="https://github.com/request/request">request</a>
one.</p>
<p>Custom implementation:</p>
<pre><code class="lang-js"><span class="comment">/*
 * url {String}
 * options {Object}
 * options.headers {Object}
 * options.body {String|Object}
 * options.form {Boolean}
 * options.query {Object}
 * options.timeout {Number}
 * options.retries {Number}
 * options.followRedirect {Boolean}
 */</span>

Issuer.httpClient = {
   get(url, options) {}, <span class="comment">// return Promise</span>
   post(url, options) {}, <span class="comment">// return Promise</span>
   HTTPError, <span class="comment">// used error constructor</span>
};
</code></pre>
<p>Bundled (and maintained + tested) request implementation after you&#39;ve added <a href="https://github.com/request/request">request</a>
to your package.json bundle:</p>
<pre><code><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">request</span>@^<span class="keyword">2</span>.<span class="keyword">0</span>.<span class="keyword">0</span> --save
</code></pre><pre><code class="lang-js">Issuer.useRequest();
</code></pre>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">openid-client</span></code></div>
            <ul>
              <li><span class="version">1.19.3</span> published <abbr class="updated" title="2018-01-22T17:25:57Z">7 days ago</abbr></li>
              <li><a class="url" href="git://github.com/panva/node-openid-client.git">https://github.com/panva/node-openid-client</a></li>
              <li><a rel="licence" href="http://www.opensource.org/licenses/MIT">MIT License</a></li>
            </ul>
            <ul>
              <li><b>143</b> downloads in the last day</li>
              <li><b>4,661</b> downloads in the last week</li>
              <li><b>16,542</b> downloads in the last month</li>
            </ul>
          </div>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-104798-10']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      
    </script>
    <!-- Google Tag Manager-->
    <noscript>iframe(src='//www.googletagmanager.com/ns.html?id=GTM-M5S3PH', height='0', width='0', style='display:none;visibility:hidden')</noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M5S3PH');
    </script>
    <!-- End Google Tag Manager-->
  </body>
</html>